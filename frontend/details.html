<!DOCTYPE html>
<html class="light" lang="ko"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>의안 상세 정보</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<style>
      body {
        font-family: "Public Sans", "Noto Sans KR", sans-serif;
      }
    </style>
<script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#00559F",
              "background-light": "#F5F7FA",
              "background-dark": "#101622",
              "accent": "#FFC107"
            },
            fontFamily: {
              "display": ["Public Sans", "Noto Sans KR", "sans-serif"]
            },
            borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
          },
        },
      }
    </script>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden mx-auto max-w-lg">
<header class="sticky top-0 z-10 flex items-center bg-white dark:bg-slate-900 p-4 pb-2 justify-between border-b border-slate-200 dark:border-slate-800">
<button class="text-[#212121] dark:text-white flex size-12 shrink-0 items-center justify-start">
<span class="material-symbols-outlined">arrow_back</span>
</button>
<h1 class="text-[#212121] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">의안 상세 정보</h1>
<div class="flex size-12 shrink-0 items-center"></div>
</header>
<main class="flex flex-col flex-grow">
<div class="p-4 pt-6">
<div class="flex flex-col items-stretch justify-start rounded-xl">
<div class="flex w-full grow flex-col items-stretch justify-center gap-1">
<p class="text-xs text-[#757575] dark:text-slate-400">의안번호: 2024-1234</p>
<p class="text-[#212121] dark:text-white text-xl font-bold leading-tight tracking-[-0.015em]">서울특별시 주차장 설치 및 관리 조례 일부개정조례안</p>
<div class="flex items-center gap-3 justify-start pt-2">
<div class="flex flex-col gap-1">
<p class="text-[#757575] dark:text-slate-400 text-sm font-normal leading-normal">제안자: 김의원 외 10인</p>
<p class="text-[#757575] dark:text-slate-400 text-sm font-normal leading-normal">제안일자: 2024-05-20</p>
</div>
</div>
</div>
</div>
</div>
<div class="p-4 @container">
<div class="flex flex-col items-stretch justify-start rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.08)] bg-white dark:bg-slate-800">
<div class="flex w-full grow flex-col items-stretch justify-center gap-4 p-4">
<div>
<p class="text-[#212121] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] mb-3">핵심 의제</p>
<div class="flex flex-col gap-3">
<div class="flex flex-col">
<p class="font-bold text-[#212121] dark:text-white text-base">1. 공영주차장 요금 체계 현실화</p>
<div class="pl-4 mt-2">
<p class="text-[#757575] dark:text-slate-300 text-sm leading-relaxed"><strong>박위원 (찬성):</strong> "야간 주차 요금 할인율을 조정하여 주차장 운영의 효율성을 높이고, 수익성을 개선해야 합니다."</p>
<p class="text-[#757575] dark:text-slate-300 text-sm leading-relaxed mt-1"><strong>최위원 (반대):</strong> "시민 부담을 가중시킬 수 있으므로, 할인율 조정은 신중하게 접근해야 합니다."</p>
</div>
</div>
<div class="flex flex-col">
<p class="font-bold text-[#212121] dark:text-white text-base">2. 전기차 충전 구역 관리 강화</p>
<div class="pl-4 mt-2">
<p class="text-[#757575] dark:text-slate-300 text-sm leading-relaxed"><strong>김위원 (찬성):</strong> "충전 방해 행위에 대한 과태료를 상향하여, 전기차 이용자들의 편의를 보장해야 합니다."</p>
</div>
</div>
</div>
</div>
<div class="border-t border-slate-200 dark:border-slate-700 mt-4"></div>
<details class="flex flex-col group pt-4" open="">
<summary class="flex cursor-pointer items-center justify-between gap-6 py-1">
<p class="text-[#212121] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">쉬운 용어 설명</p>
<div class="text-[#212121] dark:text-white group-open:rotate-180 transition-transform">
<span class="material-symbols-outlined">expand_more</span>
</div>
</summary>
<div class="pt-2 flex flex-col gap-2">
<div class="flex items-start gap-2">
<span class="material-symbols-outlined text-primary text-xl mt-0.5">help_outline</span>
<p class="text-[#757575] dark:text-slate-300 text-sm font-normal leading-normal flex-1"><strong class="font-medium text-[#212121] dark:text-white">조례:</strong> 서울시와 같이 특정 지역에서만 적용되는 법을 의미합니다.</p>
</div>
<div class="flex items-start gap-2">
<span class="material-symbols-outlined text-primary text-xl mt-0.5">help_outline</span>
<p class="text-[#757575] dark:text-slate-300 text-sm font-normal leading-normal flex-1"><strong class="font-medium text-[#212121] dark:text-white">과태료:</strong> 법규를 위반했을 때 내는 벌금과 비슷한 개념입니다.</p>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="p-4 pt-8">
<button class="flex w-full items-center justify-center gap-2 rounded-lg bg-primary px-6 py-3 text-base font-bold text-white transition-colors hover:bg-primary/90">
<span>의안 원문 전체 보기</span>
<span class="material-symbols-outlined">arrow_forward</span>
</button>
</div>
<div class="px-4 py-6">
<h2 class="text-[#212121] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] pb-3">함께 보면 좋은 관련 의안</h2>
<div class="flex flex-col gap-3">
<div class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-4">
<p class="text-[#212121] dark:text-white font-bold leading-tight">서울특별시 전기자동차 이용 활성화 조례 일부개정조례안</p>
<p class="text-[#757575] dark:text-slate-400 text-sm mt-1">전기차 충전 인프라 확충 및 보조금 지원 확대에 관한 내용을 담고 있습니다.</p>
</div>
<div class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-4">
<p class="text-[#212121] dark:text-white font-bold leading-tight">서울특별시 공유주차장 활성화 지원 조례안</p>
<p class="text-[#757575] dark:text-slate-400 text-sm mt-1">유휴 주차 공간을 공유하여 주차 문제를 해결하기 위한 지원책을 마련합니다.</p>
</div>
</div>
</div>
</main>
<nav class="sticky bottom-0 z-10 flex justify-around border-t border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm">
<a class="flex flex-col items-center gap-1 p-3 text-primary" href="#">
<span class="material-symbols-outlined">home</span>
<span class="text-xs font-medium">홈</span>
</a>
<a class="flex flex-col items-center gap-1 p-3 text-[#757575] dark:text-slate-400" href="#">
<span class="material-symbols-outlined">search</span>
<span class="text-xs font-medium">검색</span>
</a>
<a class="flex flex-col items-center gap-1 p-3 text-[#757575] dark:text-slate-400" href="#">
<span class="material-symbols-outlined">person</span>
<span class="text-xs font-medium">마이페이지</span>
</a>
</nav>
</div>

<script>
// URL에서 agenda_id 가져오기
const urlParams = new URLSearchParams(window.location.search);
const agendaId = urlParams.get('agenda_id');

if (!agendaId) {
  alert('안건 ID가 없습니다.');
  window.location.href = '/';
}

// 안건 상세 정보 로드
async function loadAgendaDetail() {
  try {
    const response = await fetch(`/api/agenda/${agendaId}`);

    if (!response.ok) {
      throw new Error('안건 정보를 불러올 수 없습니다.');
    }

    const data = await response.json();

    // 페이지에 데이터 표시
    displayAgendaDetail(data);
  } catch (error) {
    console.error('Error:', error);
    alert('안건 정보를 불러오는데 실패했습니다.');
  }
}

function displayAgendaDetail(data) {
  // 의안번호 (agenda_id 표시)
  document.querySelector('.text-xs.text-\\[\\#757575\\]').textContent = `의안번호: ${data.agenda_id}`;

  // 제목
  document.querySelector('.text-xl.font-bold').textContent = data.title;

  // 제안자 및 제안일자
  const infoDiv = document.querySelector('.flex.flex-col.gap-1');
  infoDiv.innerHTML = `
    <p class="text-[#757575] dark:text-slate-400 text-sm font-normal leading-normal">주 발언자: ${data.main_speaker}</p>
    <p class="text-[#757575] dark:text-slate-400 text-sm font-normal leading-normal">회의일자: ${data.meeting_date}</p>
    <p class="text-[#757575] dark:text-slate-400 text-sm font-normal leading-normal">상태: ${data.status}</p>
  `;

  // 핵심 의제 표시
  const issuesDiv = document.querySelector('.flex.flex-col.gap-3');

  if (data.key_issues && data.key_issues.length > 0) {
    // AI가 생성한 핵심 의제 표시
    issuesDiv.innerHTML = '';
    data.key_issues.forEach((issue, index) => {
      const issueDiv = document.createElement('div');
      issueDiv.className = 'flex flex-col';
      issueDiv.innerHTML = `
        <p class="font-bold text-[#212121] dark:text-white text-base">${index + 1}. ${issue}</p>
      `;
      issuesDiv.appendChild(issueDiv);
    });
  } else {
    // 핵심 의제가 없으면 발언자별로 텍스트 그룹핑 (기존 방식)
    const speakerTexts = {};
    data.chunks.forEach(chunk => {
      if (!speakerTexts[chunk.speaker]) {
        speakerTexts[chunk.speaker] = [];
      }
      speakerTexts[chunk.speaker].push(chunk.text_preview);
    });

    issuesDiv.innerHTML = '';
    let issueIndex = 1;

    for (const [speaker, texts] of Object.entries(speakerTexts)) {
      if (issueIndex > 3) break; // 최대 3개만 표시

      const issueDiv = document.createElement('div');
      issueDiv.className = 'flex flex-col';
      issueDiv.innerHTML = `
        <p class="font-bold text-[#212121] dark:text-white text-base">${issueIndex}. ${speaker}의 발언</p>
        <div class="pl-4 mt-2">
          <p class="text-[#757575] dark:text-slate-300 text-sm leading-relaxed">
            <strong>${speaker}:</strong> "${texts[0].substring(0, 150)}..."
          </p>
        </div>
      `;
      issuesDiv.appendChild(issueDiv);
      issueIndex++;
    }
  }

  // 의안 원문 전체 보기 버튼
  const fullTextButton = document.querySelector('button.bg-primary');
  if (data.meeting_url) {
    fullTextButton.onclick = () => {
      window.open(data.meeting_url, '_blank');
    };
  }
}

// 뒤로가기 버튼
document.querySelector('button.text-\\[\\#212121\\]').onclick = () => {
  window.history.back();
};

// 페이지 로드 시 데이터 가져오기
loadAgendaDetail();
</script>

</body></html>